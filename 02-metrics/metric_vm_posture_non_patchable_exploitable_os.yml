---
metric_id: vm_posture_non_patchable_exploitable_os
title: Systems without non-patchable exploitable OS vulnerabilities
category: Vulnerability Management
type: risk
description: |
  The percentage of systems that were active in the last 30 days
  that have addressed non-patchable, exploitable operating system vulnerabilities,
  providing critical insight into the organisation's "Emergency Mitigations"
  capability requiring compensating controls NOW.
how: |
  Find all active hosts per your vulnerability management system. Join the
  hosts with the vulnerability database, and filter the vulnerabilities
  on the criteria as defined in the metric definition (non-patchable + exploitable + OS).
slo:
  - 0.90
  - 0.98
weight: 0.9
enabled: true
indicator: false
references:
  "ISO 27001:2022":
    - A.8.8
  "CIS 8.1":
    - 7.5
    - 7.6
  "NIST CSF v2.0":
    - ID.RA-01
query:
  - |
    SELECT
      host.hostname AS resource,
      'host' as resource_type,
      CASE
        WHEN count(cve.aid) = 0 THEN 1
        ELSE 0
      END AS compliance,
      CAST(count(cve.*) as text) AS detail
    FROM
      {{ ref('crowdstrike_hosts') }} AS host
    LEFT JOIN
      {{ ref('crowdstrike_vulnerabilities') }} AS cve
    ON
      host.device_id = cve.aid
      AND cve.status IN ('open', 'reopen')
      AND coalesce(cve.cve.remediation_level != 'O', true)
      AND coalesce(cve.cve.exploit_status > 0, false)
      AND cve.severity IN ('HIGH', 'CRITICAL')
    WHERE
      CURRENT_DATE - CAST(STRPTIME(host.last_seen, '%Y-%m-%dT%H:%M:%SZ') AS DATE) < 30
    GROUP BY
      host.hostname
  - |
    SELECT
      asset.hostname AS resource,
      'host' AS resource_type,
      CASE
        WHEN count(cve.plugin.id) = 0 THEN 1
        ELSE 0
      END AS compliance,
      CAST(count(cve.plugin) AS text) AS detail
    FROM
      {{ ref('tenable_assets') }} AS asset
    LEFT JOIN
      {{ ref('tenable_vulnerabilities') }} AS cve
    ON
      asset.uuid = cve.asset.uuid
      AND cve.state IN ('OPEN', 'REOPENED')
      AND cve.plugin.exploit_available IS TRUE
      AND cve.plugin.has_patch IS FALSE
      AND cve.severity IN ('high', 'critical')
    WHERE
      CURRENT_DATE - CAST(asset.last_seen AS DATE) < 30
    GROUP BY
      asset.hostname